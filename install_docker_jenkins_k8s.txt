#!/bin/bash

set -e

echo "ğŸ”„ Updating package index..."
sudo apt-get update

echo "ğŸ“¦ Installing required packages..."
sudo apt-get install -y ca-certificates curl fontconfig openjdk-21-jre

echo "ğŸ“ Creating keyring directory for Docker..."
sudo install -m 0755 -d /etc/apt/keyrings

echo "ğŸ”‘ Adding Docker's official GPG key..."
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

echo "ğŸ“ Adding Docker repository to Apt sources..."
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo \"${UBUNTU_CODENAME:-$VERSION_CODENAME}\") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

echo "ğŸ”„ Updating package index again..."
sudo apt-get update

echo "ğŸ“¦ Installing Docker packages..."
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

echo "ğŸš€ Starting Docker service..."
sudo systemctl start docker

echo "ğŸ” Checking Docker service status..."
#sudo systemctl status docker

echo "ğŸ‘¤ Adding current user '$USER' to the 'docker' group..."
sudo usermod -aG docker $USER

echo "ğŸ”‘ Adding Jenkins GPG key..."
sudo wget -O /etc/apt/keyrings/jenkins-keyring.asc https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key

echo "ğŸ“ Adding Jenkins repository..."
echo "deb [signed-by=/etc/apt/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian-stable binary/" | \
  sudo tee /etc/apt/sources.list.d/jenkins.list > /dev/null

echo "ğŸ”„ Updating package index for Jenkins..."
sudo apt-get update

echo "ğŸ“¦ Installing Jenkins..."
sudo apt-get install -y jenkins

echo "ğŸ”§ Enabling and starting Jenkins service..."
sudo systemctl enable jenkins
sudo systemctl start jenkins

echo "ğŸ” Checking Jenkins service status..."
#sudo systemctl status jenkins

echo "ğŸ“¦ Installing git..."


sudo apt update -y

echo "ğŸ“¦ Installing Jenkins..."

sudo apt install git -y

git --version

echo "ğŸ“¦ Installing kubectl..."
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"

echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check

sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

rm kubectl kubectl.sha256

kubectl version --client

sudo apt-get update

echo "ğŸ“¦ Installing Minikube..."
curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube && rm minikube-linux-amd64

echo "ğŸš€ Starting Minikube..."
minikube start

echo "âœ… Installation complete!"
echo "ğŸ”„ Please log out and log back in (or restart your session) for Docker group changes to take effect."
echo "ğŸ§ª After re-login, verify Docker access with: docker run hello-world"
echo "ğŸŒ Access Jenkins at: http://localhost:8080"



